name: Strict Scale Set Test

on:
  workflow_dispatch:
    inputs:
      required_scale_set:
        description: 'Báº¯t buá»™c cháº¡y trÃªn scale set nÃ y test'
        required: true
        type: string
        default: 'cake-github-runner'

jobs:
  validate-and-run:
    runs-on: cake-github-runner
    
    steps:
      - name: Validate runner scale set
        id: validate
        run: |
          REQUIRED_SCALE_SET="${{ github.event.inputs.required_scale_set }}"
          ACTUAL_RUNNER_NAME="${{ runner.name }}"
          
          echo "Required scale set: $REQUIRED_SCALE_SET"
          echo "Actual runner name: $ACTUAL_RUNNER_NAME"
          
          # Kiá»ƒm tra runner cÃ³ Ä‘Ãºng scale set khÃ´ng
          if [[ "$ACTUAL_RUNNER_NAME" == *"$REQUIRED_SCALE_SET"* ]]; then
            echo "âœ… Runner Ä‘Ãºng scale set: $REQUIRED_SCALE_SET"
            echo "scale_set_valid=true" >> $GITHUB_OUTPUT
          else
            echo "âŒ Runner SAI scale set!"
            echo "Expected: $REQUIRED_SCALE_SET"
            echo "Actual: $ACTUAL_RUNNER_NAME"
            echo "scale_set_valid=false" >> $GITHUB_OUTPUT
            exit 1
          fi
          
      - name: Check runner labels
        if: steps.validate.outputs.scale_set_valid == 'true'
        run: |
          echo "=== Runner Labels ==="
          echo "Runner name: ${{ runner.name }}"
          echo "Runner OS: ${{ runner.os }}"
          echo "Runner arch: ${{ runner.arch }}"
          
      - name: Run actual job
        if: steps.validate.outputs.scale_set_valid == 'true'
        run: |
          echo "ï¿½ï¿½ Job Ä‘ang cháº¡y trÃªn Ä‘Ãºng scale set: ${{ github.event.inputs.required_scale_set }}"
          echo "Runner: ${{ runner.name }}"
          date
          
      - name: Fail if wrong scale set
        if: steps.validate.outputs.scale_set_valid == 'false'
        run: |
          echo "ðŸ’¥ JOB THáº¤T Báº I: KhÃ´ng thá»ƒ cháº¡y trÃªn scale set yÃªu cáº§u!"
          echo "Scale set yÃªu cáº§u: ${{ github.event.inputs.required_scale_set }}"
          echo "Scale set thá»±c táº¿: ${{ runner.name }}"
          exit 1
